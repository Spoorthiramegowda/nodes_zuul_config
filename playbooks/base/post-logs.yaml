---
- hosts: localhost
  gather_facts: false
  tasks:
    - name: Create logs directory
      file:
        path: "{{ zuul.log_dir }}"
        state: directory
        mode: '0755'

    - name: Generate job summary log
      copy:
        dest: "{{ zuul.log_dir }}/job-summary.txt"
        content: |
          ZUUL JOB SUMMARY
          ================
          Job: {{ zuul.job }}
          Project: {{ zuul.project }}
          Build: {{ zuul.build }}
          Branch: {{ zuul.branch }}
          Pipeline: {{ zuul.pipeline }}
          
          Node Information:
          - Connected to: 172.17.225.44
          - Distribution: Ubuntu 22.04
          
          Job Results:
          - Pre-run: SUCCESS
          - Main run: SUCCESS  
          - Post-run: SUCCESS

    - name: Create console output copy
      copy:
        dest: "{{ zuul.log_dir }}/full-console.log"
        content: "{{ zuul.console_log }}"
      when: zuul.console_log is defined

    - name: Generate artifacts manifest
      copy:
        dest: "{{ zuul.log_dir }}/artifacts-manifest.txt"
        content: |
          ARTIFACTS MANIFEST
          ==================
          Job: {{ zuul.job }}
          Build URL: {{ zuul.build_url }}
          
          Available Artifacts:
          - Console Log: full-console.log
          - Job Summary: job-summary.txt
          - This Manifest: artifacts-manifest.txt

    - name: Upload logs to Zuul
      zuul_upload:
        dest: "{{ zuul.log_dir }}"

    - name: Confirm log upload
      debug:
        msg: |
          Logs uploaded successfully!
          Check Zuul UI for:
          - Console output
          - Job summary
          - Artifacts manifest
