---
- hosts: localhost
  gather_facts: false
  tasks:
    - name: Create logs directory in workspace
      file:
        path: "{{ zuul.project.src_dir }}/logs"
        state: directory
        mode: '0755'

    - name: Generate job summary log
      copy:
        dest: "{{ zuul.project.src_dir }}/logs/job-summary-{{ zuul.job }}-{{ zuul.build }}.txt"
        content: |
          ZUUL JOB SUMMARY
          ================
          Job: {{ zuul.job }}
          Project: {{ zuul.project }}
          Build: {{ zuul.build }}
          Branch: {{ zuul.branch }}
          Pipeline: {{ zuul.pipeline }}
          
          Node Information:
          - Connected to: 172.17.225.44
          - Distribution: Ubuntu 22.04
          
          Job Results:
          - Pre-run: SUCCESS
          - Main run: SUCCESS  
          - Post-run: SUCCESS

    - name: Generate artifacts manifest
      copy:
        dest: "{{ zuul.project.src_dir }}/logs/artifacts-manifest-{{ zuul.job }}-{{ zuul.build }}.txt"
        content: |
          ARTIFACTS MANIFEST
          ==================
          Job: {{ zuul.job }}
          Build: {{ zuul.build }}
          
          Available Logs:
          - This manifest
          - Job summary
          - Console output (in Zuul UI)

    - name: List created log files
      command: ls -la "{{ zuul.project.src_dir }}/logs/"
      register: log_files
      changed_when: false

    - name: Display log files location
      debug:
        msg: |
          Log files created at: {{ zuul.project.src_dir }}/logs/
          Files: {{ log_files.stdout_lines }}

    - name: Confirm log creation
      debug:
        msg: |
          Log files created successfully!
          Check workspace logs directory for:
          - Job summary
          - Artifacts manifest
          
          Console output is automatically available in Zuul UI.
